# =============================================================================
# Application PDF Generation Service - Environment Configuration
# =============================================================================
# Copy this file to .env and update with your actual values
# NEVER commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Environment
# -----------------------------------------------------------------------------
# Set to 'development', 'staging', or 'production'
NODE_ENV=development

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
# Port the service will listen on
PORT=3000

# Service base URL (used for webhook callbacks, etc.)
# Development: http://localhost:3000
# Production: https://your-service-domain.com
SERVICE_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Log level: 'error', 'warn', 'info', 'debug'
# Use 'debug' for development, 'info' for production
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Salesforce Authentication - OAuth Username/Password (Development)
# -----------------------------------------------------------------------------
# Use this method for local development and testing
# Requires: Username, Password, Security Token, Login URL

# Salesforce username (email)
SF_USERNAME=your-username@example.com

# Salesforce password
SF_PASSWORD=your-password

# Security token (get from: Setup → My Personal Information → Reset My Security Token)
# For sandboxes, this is usually required
SF_SECURITY_TOKEN=your-security-token-here

# Salesforce login URL
# Sandbox: https://test.salesforce.com
# Production: https://login.salesforce.com
# Custom domain: https://your-domain.my.salesforce.com
SF_LOGIN_URL=https://test.salesforce.com

# -----------------------------------------------------------------------------
# Salesforce Authentication - Connected App (Production)
# -----------------------------------------------------------------------------
# Use this method for production deployments
# Requires: Client ID, Client Secret, Instance URL, Access Token
# See docs/application-pdf-generation/CONNECTED_APP_SETUP.md for setup

# Connected App Consumer Key (Client ID)
SF_CLIENT_ID=your-connected-app-client-id

# Connected App Consumer Secret (Client Secret)
SF_CLIENT_SECRET=your-connected-app-client-secret

# Salesforce instance URL (e.g., https://your-instance.salesforce.com)
SF_INSTANCE_URL=https://your-instance.salesforce.com

# OAuth Access Token (obtained from initial OAuth flow)
# This will be refreshed automatically using the refresh token
SF_ACCESS_TOKEN=your-access-token

# OAuth Refresh Token (obtained from initial OAuth flow)
# Used to refresh the access token when it expires
SF_REFRESH_TOKEN=your-refresh-token

# -----------------------------------------------------------------------------
# Authentication Method Selection
# -----------------------------------------------------------------------------
# The service will use the following priority:
# 1. If SF_ACCESS_TOKEN and SF_INSTANCE_URL are set → Use access token
# 2. If SF_USERNAME and SF_PASSWORD are set → Use OAuth username/password
# 3. If SF_CLIENT_ID and SF_CLIENT_SECRET are set → Use Connected App (requires OAuth flow)
#
# For development: Use SF_USERNAME/SF_PASSWORD
# For production: Use SF_CLIENT_ID/SF_CLIENT_SECRET with OAuth flow

# -----------------------------------------------------------------------------
# PDF Generation Configuration
# -----------------------------------------------------------------------------
# Directory where Handlebars templates are stored
# Default: ./templates
PDF_TEMPLATE_DIR=./templates

# Directory where generated PDFs are stored (before upload to Salesforce)
# Default: ./output
PDF_OUTPUT_DIR=./output

# Default template name (used if not specified in request)
# Default: application-default
PDF_DEFAULT_TEMPLATE=application-default

# PDF generation timeout in milliseconds
# Default: 60000 (60 seconds)
PDF_GENERATION_TIMEOUT=60000

# -----------------------------------------------------------------------------
# Platform Events (Optional)
# -----------------------------------------------------------------------------
# Platform Event channel name for async PDF generation
# Format: /event/Event_API_Name__e
# Leave empty to disable Platform Event listener
PLATFORM_EVENT_CHANNEL=/event/Application_PDF_Request__e

# Platform Event polling interval in milliseconds
# Default: 30000 (30 seconds)
# Note: For production, consider using CometD for real-time events
PLATFORM_EVENT_POLL_INTERVAL=30000

# -----------------------------------------------------------------------------
# Webhook Security (Optional)
# -----------------------------------------------------------------------------
# Secret key for webhook signature verification
# If set, webhook requests must include this secret in headers
# Leave empty to disable webhook signature verification
WEBHOOK_SECRET=

# Webhook signature header name
# Default: X-Webhook-Signature
WEBHOOK_SIGNATURE_HEADER=X-Webhook-Signature

# -----------------------------------------------------------------------------
# Field Mapping Configuration
# -----------------------------------------------------------------------------
# Directory where field mapping JSON files are stored
# Default: ./config/field-mappings
FIELD_MAPPING_DIR=./config/field-mappings

# -----------------------------------------------------------------------------
# Salesforce API Configuration
# -----------------------------------------------------------------------------
# API version to use (e.g., 'v65.0')
# Default: latest available
SF_API_VERSION=v65.0

# Maximum number of retries for failed API calls
# Default: 3
SF_MAX_RETRIES=3

# Timeout for API calls in milliseconds
# Default: 30000 (30 seconds)
SF_API_TIMEOUT=30000

# -----------------------------------------------------------------------------
# Performance & Limits
# -----------------------------------------------------------------------------
# Maximum concurrent PDF generation operations
# Default: 5
MAX_CONCURRENT_PDF_GENERATIONS=5

# Maximum number of related records to query per application
# Default: 100
MAX_RELATED_RECORDS=100

# Enable request rate limiting
# Default: false
ENABLE_RATE_LIMITING=false

# Rate limit: requests per minute per IP
# Default: 60
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# -----------------------------------------------------------------------------
# Caching (Optional)
# -----------------------------------------------------------------------------
# Enable caching of field mappings
# Default: true
ENABLE_FIELD_MAPPING_CACHE=true

# Field mapping cache TTL in milliseconds
# Default: 3600000 (1 hour)
FIELD_MAPPING_CACHE_TTL=3600000

# Enable caching of Salesforce metadata
# Default: true
ENABLE_METADATA_CACHE=true

# Metadata cache TTL in milliseconds
# Default: 86400000 (24 hours)
METADATA_CACHE_TTL=86400000

# -----------------------------------------------------------------------------
# Monitoring & Health Checks
# -----------------------------------------------------------------------------
# Enable detailed health check endpoint
# Default: true
ENABLE_DETAILED_HEALTH_CHECK=true

# Health check timeout in milliseconds
# Default: 5000 (5 seconds)
HEALTH_CHECK_TIMEOUT=5000

# -----------------------------------------------------------------------------
# Error Handling
# -----------------------------------------------------------------------------
# Send error notifications (email, Slack, etc.)
# Default: false
ENABLE_ERROR_NOTIFICATIONS=false

# Error notification webhook URL (e.g., Slack, PagerDuty)
ERROR_WEBHOOK_URL=

# Minimum log level for error notifications
# Default: error
ERROR_NOTIFICATION_MIN_LEVEL=error

# -----------------------------------------------------------------------------
# Development & Debugging
# -----------------------------------------------------------------------------
# Enable request/response logging
# Default: false (set to true for debugging)
ENABLE_REQUEST_LOGGING=false

# Enable detailed Salesforce API logging
# Default: false
ENABLE_SALESFORCE_API_LOGGING=false

# Enable Puppeteer debug mode
# Default: false (set to true to see browser console)
ENABLE_PUPPETEER_DEBUG=false

# Save generated HTML files for debugging
# Default: false
SAVE_HTML_FOR_DEBUG=false

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Allowed origins for CORS (comma-separated)
# Default: * (allows all origins)
# Production: Specify exact origins
CORS_ORIGINS=*

# Enable HTTPS only (redirects HTTP to HTTPS)
# Default: false
ENABLE_HTTPS_ONLY=false

# Trust proxy (for load balancers, reverse proxies)
# Default: false
TRUST_PROXY=false

# -----------------------------------------------------------------------------
# Notes
# -----------------------------------------------------------------------------
# 1. For development, you only need:
#    - NODE_ENV=development
#    - PORT=3000
#    - SF_USERNAME, SF_PASSWORD, SF_SECURITY_TOKEN, SF_LOGIN_URL
#
# 2. For production, you need:
#    - NODE_ENV=production
#    - SF_CLIENT_ID, SF_CLIENT_SECRET, SF_INSTANCE_URL
#    - Complete OAuth flow to get SF_ACCESS_TOKEN and SF_REFRESH_TOKEN
#
# 3. Never commit this file or .env to version control
#
# 4. Use environment-specific .env files:
#    - .env.development
#    - .env.staging
#    - .env.production
#
# 5. For containerized deployments, use environment variables directly
#    instead of .env files
