# Field Mapping Configuration

Field mapping files define which fields to include in PDFs for each school/program combination.

## File Naming

- `default.json` - Base configuration with all common fields
- `tcs.json` - The Chicago School (flagship school)
- `col.json` - The Colleges of Law
- `illinoiscom.json` - Illinois College of Osteopathic Medicine
- `khsu.json` - Kansas Health Science University
- `poc.json` - Pacific Oaks College
- `say.json` - Saybrook University
- `uws.json` - University of Western States

## Inheritance

School configs can inherit from other configs using the `extends` property:

```json
{
  "extends": "default",
  "schoolName": "My School",
  "overrideSections": [...],
  "addSections": [...],
  "removeSections": [...]
}
```

### Inheritance Properties

| Property | Description |
|----------|-------------|
| `extends` | Name of parent config to inherit from (filename without `.json`) |
| `overrideSections` | Array of sections that replace inherited sections with the same name |
| `addSections` | Array of sections to add after inherited sections |
| `removeSections` | Array of section names to remove from inherited config |
| `sections` | If provided, completely replaces all inherited sections |

### Inheritance Chain Example

```
default.json (base)
  └── tcs.json (The Chicago School - flagship)
  └── illinoiscom.json (adds waitlist fields)
      └── khsu.json (inherits from illinoiscom)
  └── poc.json (adds LACOE field)
  └── say.json
  └── col.json
  └── uws.json (most customized)
```

## Structure

```json
{
  "extends": "default",
  "schoolId": "001XXXXXXXXXXXXXXX",
  "programId": "a0XXXXXXXXXXXXXXXX",
  "schoolName": "School Name",
  "programName": "Program Name",
  "overrideSections": [
    {
      "name": "Section Title",
      "fields": [
        {
          "apiName": "FieldApiName",
          "label": "Display Label",
          "format": "date|currency|phone"
        }
      ]
    }
  ],
  "addSections": [
    {
      "name": "School-Specific Section",
      "fields": [...]
    }
  ]
}
```

## Field API Names

### IndividualApplication Fields
- Standard fields: `Id`, `Name`, `AccountId`, `Category`, `Status`
- Custom fields: Use the full API name (e.g., `Custom_Field__c`)
- Contact via: `Contact_ID__c` (queried separately, not direct relationship)

**Note:** Requires Salesforce API v65.0 for Education Cloud objects like `LearningProgram`.

### Related Records
- Employment: `relatedRecords.Employment[0].FieldName`
- High School: `relatedRecords.HighSchool[0].FieldName`
- College: `relatedRecords.College[0].FieldName`

## Format Options

- `date` - Formats as locale date string
- `currency` - Formats as USD currency
- `phone` - Formats phone number

## School-Specific Fields

| School | Unique Fields |
|--------|--------------|
| TCS | Base fields + Acknowledge Statement Signature |
| IllinoisCOM | + Waitlist Activated, Date Waitlist Activated |
| KHSU | Same as IllinoisCOM (inherits) |
| POC | + LACOE Student |
| UWS | + Has Bachelors, Pursue BS Human Bio, Current Student, Wish to Withdraw, Conviction Detail, Academic Sanction, Relative Attended/Employed |
| COL | Base fields |
| SAY | Base fields |

## PDF Output

### File Versioning

When PDFs are uploaded to Salesforce, the system checks if a file with the same title already exists:
- **Existing file found**: Creates a new version (v2, v3, etc.)
- **No existing file**: Creates a new ContentDocument

This ensures a single file per application with full version history.

### Footer

All PDFs include a footer with:
- **Created on**: Local date when PDF was generated
- **Service attribution**: "Generated by Application PDF Service"

## Legacy PDF Field Reference

The legacy Apex PDF system uses these sections and fields (all should be included for parity):

### Information Section
- `Name`, `Status`, `AppliedDate`, `LearningProgram`, `AcademicTerm`, `Location__c`

### Name Section (Contact)
- `Salutation`, `FirstName`, `MiddleName`, `LastName`
- `Preferred_First_Name__c`, `Former_Last_Name__c`

### Contact Section
- `Email`, `MobilePhone`, `HomePhone`, `OtherPhone` (Work)
- `Preferred_Phone_Type__c`, `Secondary_Preferred_Phone_Type__c`

### Physical Address Section (Contact)
- `OtherStreet`, `OtherCity`, `OtherState`, `OtherPostalCode`, `OtherCountry`

### Mailing Address Section (Contact)
- `MailingStreet`, `MailingCity`, `MailingState`, `MailingPostalCode`, `MailingCountry`

### Military Section
- `Contact.Military_Status__c`, `Has_Previously_Applied__c`

### Compliance Section (20 fields!)
- `Contact.Citizenship_Status__c`, `Contact.Visa_Needed_to_Study__c`
- `Contact.Own_a_US_Visa__c`, `Contact.Reported_Visa_Type__c`
- `Contact.Enrolled_in_other_U_S_Institution__c`, `Contact.SSN__c`
- `Contact.Birthdate`, `Contact.Birth_Country__c`, `Contact.Birth_City__c`, `Contact.Birth_State__c`
- `Contact.Sex__c`, `Contact.GenderIdentity`, `Contact.Pronouns`
- `Contact.Sexual_Orientation__c`, `Contact.Ethnicity__c`, `Contact.Race__c`
- `Contact.Is_English_Primary_Language__c`
- `How_did_you_hear_about_us__c`, `Applying_for_Financial_Aid__c`

### Education/Professional Section
- `Seeking_Transfer_Credit__c`, `Initiating_Articulation_Agreement__c`, `First_Generation_Student__c`

### Prior College Section
- `Enrolled_in_AA_T_or_AS_T_degree_transfer__c`

## Examples

See the existing Apex class `ApplicationPdfController` for reference on available fields:
- PersonEmployment: `Name`, `Position`, `EmploymentType`, `Sector__c`
- PersonEducation: `Name`, `EducationLevel`, `GraduationDate`, `CumulativeGPA`, `IdentifierIssuer`, `Educational_Institution__c`

## Field Permissions

If a field returns `null` via API but exists in Salesforce, it's likely a field-level security issue.

1. Query via SF CLI to verify field exists
2. Add field permission to `force-app/main/default/permissionsets/PDF_Generation_Service.permissionset-meta.xml`
3. Deploy: `sf project deploy start --target-org staging --metadata PermissionSet:PDF_Generation_Service`

See `.cursorrules` and `docs/troubleshooting.md` for detailed instructions.
